//    Copyright 2023 Amol Upadhye
//
//    This file is part of hyphi.
//
//    hyphi is free software: you can redistribute it and/or modify
//    it under the terms of the GNU General Public License as published by
//    the Free Software Foundation, either version 3 of the License, or
//    (at your option) any later version.
//
//    hyphi is distributed in the hope that it will be useful,
//    but WITHOUT ANY WARRANTY; without even the implied warranty of
//    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//    GNU General Public License for more details.
//
//    You should have received a copy of the GNU General Public License
//    along with hyphi.  If not, see <http://www.gnu.org/licenses/>.

//Date: 2023-07-13
// This is an auto-generated header by Amol Upadhye based upon the file 
// sup_model_2022-11-18/PK_SUP/BAHAMAS_fb_M200.csv made by Jaime Salcido
// on 2022-11-18.  It creates arrays for an interpolation of the relative
// baryon fraction {\tilde f}_b as a function of z and {\hat M}, the 
// optimally-correlated mass defined in his baryonic suppression fitting 
// function paper called {\em A hydrodynamical simulation-based model for
// the impact of baryon physics on the non-linear matter power spectrum},
// fit for a suite of 400 LambdaCDM models.

//numbers of redshifts and masses
const int AU_FTB_NZ = 14, AU_FTB_NM = 44;

//list of redshifts
const double AU_FTB_Z[AU_FTB_NZ] = 
  {0.125, 0.25, 0.375, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0, 
   2.25, 2.5, 2.75, 3.0};

//list of log_{10}(\hat M)
const double AU_FTB_LOG10MHAT[AU_FTB_NM] = {
11,11.1,11.2,11.3,11.4,11.5,11.6,11.7,11.8,11.9,12,12.1,12.2,12.3,12.4,12.5,12.6,12.7,12.8,12.9,13,13.1,13.2,13.3,13.4,13.5,13.6,13.7,13.8,13.9,14,14.1,14.2,14.3,14.4,14.5,14.6,14.7,14.8,14.9,15,15.1,15.2,15.3};

//array of {\tilde f}_b values to interpolate.  At higher z, where the
// highest {\hat M} are not available, I assume that {\tilde f}_b takes
// the same value as at the highest available {\hat M}.
const double AU_FTB_F_ARRAY[AU_FTB_NZ * AU_FTB_NM] = {
0.687367825029278,0.6956324875375194,0.7030688226645987,0.7419335334030321,0.7681637586967215,0.7952723845212964,0.8248114507012723,0.8422356965787664,0.7791487983675588,0.6753899494716504,0.6266167376345898,0.5949602601785317,0.5583913492893106,0.5130914493648825,0.4686586084776902,0.4235050657802718,0.3874924391347124,0.35470743558291595,0.33728583742590296,0.3286489640672005,0.3246100210372891,0.3274563271819645,0.3463563210080797,0.36447004473746347,0.3897905931720562,0.42348849999005855,0.4556954198093072,0.4963490730869793,0.5390029949794454,0.5852921168750159,0.6230115902314451,0.6703687731701405,0.7041694000026406,0.7422821172542191,0.7764900943059958,0.7974679476787274,0.8288452156795537,0.8289703707081761,0.8678048313129878,0.8566385724748179,0.8868507108454903,0.9176981845959156,0.9333537234956026,0.9484002208825618,
0.6986981894664874,0.7137561689008773,0.7203073275433548,0.7597630400033708,0.7849241836235793,0.8101134678017342,0.8374116267316344,0.8536760749410343,0.7856012485459412,0.6688052615079231,0.6236863548598677,0.5938642573440789,0.5631509878559229,0.5177647934214521,0.4733981035980186,0.4303907935881494,0.3976959092048935,0.36886206487830175,0.3506419101674475,0.3426785193307598,0.3428006518389016,0.34903239731182417,0.36488623549503857,0.38570066050221374,0.41046272768948827,0.4442245909420327,0.4744378365069457,0.5170123825450331,0.5572854553919316,0.5968911012745219,0.6368475331916058,0.6790205295107343,0.7199479275647832,0.7495826447057261,0.7772766509874287,0.8158023882144315,0.8249229338492776,0.8471885263103867,0.8552828635451661,0.8552895048226411,0.8777516424137162,0.9149335875834359,0.8866342776349665,0.9367700366054276,
0.7396720900620991,0.7347176307781964,0.7379828183930964,0.7756874901214417,0.8011227040913899,0.8241906614566079,0.8493041263770948,0.864431700780706,0.7932902947683618,0.6651496378275943,0.6206115101942828,0.5997273686614931,0.5635039818857952,0.5236487624722274,0.4784099974042063,0.4378273800301475,0.40796424258914304,0.3789801277296267,0.3663435014928453,0.3574166399385229,0.3590583950210336,0.3661041809676744,0.3821078931060221,0.4042803579452981,0.4314967248217692,0.4608480178791831,0.4954198069182177,0.5351002692401788,0.5774122258416579,0.6144670646779217,0.6509041307673815,0.6951265502647497,0.7362334442799798,0.7601682353822817,0.7832580535121373,0.8162550773432634,0.8324484007653218,0.8412400939878955,0.8538987987208422,0.8858738013907587,0.8985552081020454,0.9167187126599587,0.9167187126599587,0.9167187126599587,
0.7420626020831786,0.7575499570558306,0.7542762237179643,0.7919086306482704,0.8148385215235279,0.8378360772613774,0.8606191672618824,0.8755790992671044,0.8052792099627059,0.6646850397044614,0.6245644283815908,0.5996471584078213,0.5682120357375514,0.5278835535427066,0.4853676236834072,0.4476795905816057,0.4165886113404544,0.3893707899687514,0.3809671490170061,0.3720298641229429,0.376028305898115,0.38420101091876746,0.4006340303989847,0.4211409267514874,0.4501730707184465,0.4779814697831261,0.5148769582371181,0.5501710630878894,0.5885836278428579,0.6249250526249165,0.6713882484379512,0.7107921910253115,0.7312904392489052,0.7652164152334386,0.8012124939432297,0.8264627368734309,0.8433570092055183,0.8625245792085603,0.8885377685608123,0.9133611930135784,0.8978845090442471,0.8958598922248108,0.9123254726101552,0.9123254726101552,
0.7901438589653403,0.7932123477248747,0.7848772965452554,0.8195058850415883,0.8427013618980803,0.8611423534415604,0.8828532714228439,0.8963111094927081,0.8304068132047401,0.6758213750912566,0.6316250457252606,0.6074912422592844,0.5767257037635629,0.5411251494198126,0.5021703310056941,0.4641601183534243,0.4363496595290789,0.4165735812632004,0.4062208386265755,0.4044627066553289,0.4068260555601312,0.4190098740643379,0.432667795500154,0.4554212042618503,0.4857502150139071,0.511773127668209,0.5445945345203898,0.5806108873262259,0.6136973934480405,0.6594099235184901,0.6828468467175189,0.7167513533943038,0.7490032170812669,0.7852435131585709,0.8162909349050147,0.8260970558178738,0.8415565740399062,0.8694568773637891,0.8656239380845414,0.8814833661136895,0.903608712395624,0.8958328725217106,0.8958328725217106,0.8958328725217106,
0.8471769272440682,0.829602251959821,0.8261226112211512,0.8464862972822806,0.8674157240940912,0.8828320945444573,0.9031105905589436,0.9159685228333287,0.8575493997364229,0.6878629786864172,0.646293356184072,0.6203634493039996,0.5934022156698294,0.5561704594676361,0.5169248947594346,0.4846551898815474,0.4603885879358812,0.4410423242065426,0.4365158366803676,0.4331118134645959,0.4400340504724311,0.4504839231233209,0.4649731270778058,0.4877590288326274,0.5176684962738672,0.5409801061205448,0.5760042713579215,0.6056184380215001,0.6429810321149209,0.6843165787587074,0.6967431981470481,0.7434940320226964,0.783733387435818,0.7922624311829425,0.8351114721322929,0.8268730561623342,0.8340927629832945,0.8620829284026179,0.9106597285726298,0.9125701228422372,0.9125701228422372,0.9125701228422372,0.9125701228422372,0.9125701228422372,
0.8987346886988202,0.8656525237255591,0.862886675659804,0.8742538230729037,0.8914879191057036,0.904821082980134,0.922617023862474,0.9337193936956704,0.8843353910254917,0.7126162906672623,0.6683716398932238,0.6434215070102763,0.6109730565741159,0.5753276365515992,0.5393734595897945,0.5079604792706228,0.4859489932451688,0.4681446240441008,0.4628338485227776,0.4638358042549025,0.4675752552822919,0.4786979039602693,0.4952858775285864,0.5192576941131157,0.5431735952617744,0.567200456646328,0.5944769878776357,0.6255497096158019,0.6683453542568325,0.6867006797522027,0.7339121767210908,0.7693866879316151,0.8139850600128232,0.8264202211693159,0.8863560030660596,0.8722301084308326,0.8976850063581009,0.9135134522488914,0.9135134522488914,0.9135134522488914,0.9135134522488914,0.9135134522488914,0.9135134522488914,0.9135134522488914,
0.9459498835806304,0.9059336911701472,0.8956678818607273,0.8992576625688766,0.9131216186630966,0.9261975773417988,0.9403314364872092,0.9502326481648654,0.911815016291272,0.7479706561755559,0.69409415048472,0.6675554800531152,0.6358217879269558,0.6011476394026691,0.5621002909058725,0.5337897527724998,0.512955609745981,0.4978303447706957,0.4935664660262146,0.4917319485498725,0.4985363582831649,0.5078729016437005,0.5262459030267065,0.5512875192801644,0.570076035534398,0.5895697754123276,0.6216189530298105,0.6537620441140538,0.6681711380966755,0.7171368475766077,0.7420974484394525,0.7987290193087327,0.8252061620748442,0.810484915260535,0.8600479427311291,0.8784130857381119,0.8784130857381119,0.8784130857381119,0.8784130857381119,0.8784130857381119,0.8784130857381119,0.8784130857381119,0.8784130857381119,0.8784130857381119,
0.9504444968318148,0.9192751755829852,0.924479794437526,0.9218309023229746,0.9332574006704121,0.9447906258947046,0.9557668513271564,0.9645022205910658,0.936954535479134,0.7873206101451221,0.7240971393982114,0.6945992319581421,0.6644259376294379,0.6266802821022164,0.5902800206126786,0.5700471980343242,0.5396539322353107,0.5263742984095062,0.5228425086800984,0.5205213039164499,0.5241143179019345,0.5388261353408236,0.5507224097982074,0.5702652842362094,0.5944408984731191,0.6254453678544676,0.6365970204949681,0.6711242749931253,0.7149296474100306,0.7320362624459564,0.7792704131056762,0.7806252929696509,0.8070101659322542,0.8432586259151611,0.8629622005481928,0.8629622005481928,0.8629622005481928,0.8629622005481928,0.8629622005481928,0.8629622005481928,0.8629622005481928,0.8629622005481928,0.8629622005481928,0.8629622005481928,
0.9489186573463656,0.9579399066380074,0.9349996865428084,0.9455720039778904,0.9532231908883044,0.9619608618821224,0.9701658671485344,0.9766772383745912,0.956223594714417,0.8303206220301576,0.750311253052496,0.7235309023464304,0.6858858769596415,0.6548623306071886,0.6226140063414811,0.5946626007006431,0.5699507103412347,0.5615893036899616,0.5508036464973118,0.5504736047863333,0.557874481703073,0.5661533000969454,0.5833771229631539,0.5966149539093226,0.6212548469431106,0.6413327651207169,0.6600292412551144,0.6956886040358711,0.733401750036612,0.7725801212997381,0.7941847707710945,0.829625027268496,0.8335933515340357,0.8517887324377467,0.8517887324377467,0.8517887324377467,0.8517887324377467,0.8517887324377467,0.8517887324377467,0.8517887324377467,0.8517887324377467,0.8517887324377467,0.8517887324377467,0.8517887324377467,
0.944468297413244,0.9917795116101192,0.9634658760816546,0.963757361268458,0.9608971520775716,0.9689117543260192,0.9824561402908112,0.987142080074672,0.971060625746014,0.875424618749135,0.7828849044994303,0.7463658494516853,0.7163111976859599,0.6812700731046442,0.6550476720260496,0.6223308301911383,0.6007872109914683,0.5881813618716978,0.5779194243414945,0.5795509770528253,0.587587495411771,0.5970120585519111,0.600734515892776,0.6345038530164437,0.6524401507321387,0.6693436597593636,0.702015367163864,0.7118838933814292,0.7628727108347002,0.77703799370317,0.8069049708012219,0.9223206056025992,0.8228496194536806,0.8228496194536806,0.8228496194536806,0.8228496194536806,0.8228496194536806,0.8228496194536806,0.8228496194536806,0.8228496194536806,0.8228496194536806,0.8228496194536806,0.8228496194536806,0.8228496194536806,
1.1012939871331566,0.9992104930158564,0.9664081411737038,0.9726857206082784,0.9770354631695564,0.9813216415263268,0.9854483594642208,0.9889738418840792,0.9807489930358184,0.9113344103400196,0.8099368440582843,0.7648635761503841,0.7386893241480654,0.7057853314468585,0.6797567209396929,0.6494637855160389,0.6304503425485514,0.6154248503244529,0.6137109369167556,0.6096047248634888,0.611859280467422,0.6268427657187768,0.6327901780534158,0.6561587264869693,0.6620244283198111,0.6796752553252456,0.7202205328448117,0.6894777849968478,0.8542675526018052,0.7731108873842173,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,0.8659241658364596,
0.9504444982763716,0.9999999462914424,0.96803823135008,0.9737945807642744,0.9785181563617597,0.9825600188519434,0.9867206114372109,0.9907472352919876,0.9879372150247114,0.9353456662035172,0.8351486010793885,0.7939263891835849,0.7610816133953896,0.7327447044182241,0.7064463391895391,0.6791067038619765,0.6613303933290625,0.6521508188756757,0.6345584133558431,0.6320611160581434,0.6377830739408697,0.6434549605211316,0.6687643526694234,0.6718138522686822,0.6987500443240268,0.6920084279317629,0.7172492755225471,0.7550131564972615,0.8257297944158789,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,0.9066063170139022,
1.049580313142511,0.9999999634009004,0.9689117606696332,0.975193356341358,0.9800586776515668,0.9839058032415549,0.9943162301078858,0.9980067398342652,0.990280914167346,0.9562083427922192,0.8647570393299824,0.8132353030298785,0.7826094353604386,0.7563234659938257,0.7320300706780624,0.704815865353475,0.6893706650558034,0.6731562377374695,0.6624473421792948,0.6570417086071559,0.6485751056039002,0.6696924375373732,0.6973016375980671,0.7264461548209162,0.7535675917640918,0.7934681456397924,0.7538345417563423,0.8435623399848996,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,0.86998972437802,
};

const double hyd_alpha_data[] =
  {15.24311120000861,-1.2436699435560352,0.14837558774401766};
const double hyd_beta_data[] =
  {14.969187892657688,-1.0993025612653198,0.12905587245129102};
const double hyd_gamma_data[] =
  {0.8000441576980428,-0.01715621131893159,0.06131887249968379};
const double hyd_lambda_a_data[] =
  {0.02178116280689233,-0.0077564325654746955,0.0007915576054589781};
const double hyd_lambda_b_data[] =
  {3.0878286643613437,0.4529677646796634,0.001552571083240605};
const double hyd_mu_a_data[] =
  {0.6930259177449359,-0.16913553700233935,0.04263185199898842};
const double hyd_mu_b_data[] =
  {3.161914061444856,0.8616834297321924,0.011346427353554053};
const double hyd_mu_c_data[] =
  {5.532188503256583,-3.0864672185252537,0.5083422518560442};
const double hyd_nu_a_data[] =
  {413.00988701513904,311.63957063032285,37.89105940901369};
const double hyd_nu_b_data[] =
  {-11.243859405779181,-0.34421412616421965,0.3343548325485801};
const double hyd_nu_c_data[] =
  {3.476463891168505,-0.018333059687988575,-0.08276237963970698};

double hyd_alpha(double z){
  return hyd_alpha_data[0] + hyd_alpha_data[1]*(1.0+z)
    + hyd_alpha_data[2]*(1.0+z)*(1.0+z);
}
double hyd_beta(double z){
  return hyd_beta_data[0] + hyd_beta_data[1]*(1.0+z)
    + hyd_beta_data[2]*(1.0+z)*(1.0+z);
}
double hyd_gamma(double z){
  return hyd_gamma_data[0] + hyd_gamma_data[1]*(1.0+z)
    + hyd_gamma_data[2]*(1.0+z)*(1.0+z);
}
double hyd_lambda_a(double z){
  return hyd_lambda_a_data[0] + hyd_lambda_a_data[1]*(1.0+z)
    + hyd_lambda_a_data[2]*(1.0+z)*(1.0+z);
}
double hyd_lambda_b(double z){
  return hyd_lambda_b_data[0] + hyd_lambda_b_data[1]*(1.0+z)
    + hyd_lambda_b_data[2]*(1.0+z)*(1.0+z);
}
double hyd_mu_a(double z){
  return hyd_mu_a_data[0] + hyd_mu_a_data[1]*(1.0+z)
    + hyd_mu_a_data[2]*(1.0+z)*(1.0+z);
}
double hyd_mu_b(double z){
  return hyd_mu_b_data[0] + hyd_mu_b_data[1]*(1.0+z)
    + hyd_mu_b_data[2]*(1.0+z)*(1.0+z);
}
double hyd_mu_c(double z){
  return hyd_mu_c_data[0] + hyd_mu_c_data[1]*(1.0+z)
    + hyd_mu_c_data[2]*(1.0+z)*(1.0+z);
}
double hyd_nu_a(double z){
  return hyd_nu_a_data[0] + hyd_nu_a_data[1]*(1.0+z)
    + hyd_nu_a_data[2]*(1.0+z)*(1.0+z);
}
double hyd_nu_b(double z){
  return hyd_nu_b_data[0] + hyd_nu_b_data[1]*(1.0+z)
    + hyd_nu_b_data[2]*(1.0+z)*(1.0+z);
}
double hyd_nu_c(double z){
  return hyd_nu_c_data[0] + hyd_nu_c_data[1]*(1.0+z)
    + hyd_nu_c_data[2]*(1.0+z)*(1.0+z);
}

double hyd_lambda(double z,double k){
  return 1.0 + hyd_lambda_a(z) * exp(hyd_lambda_b(z)*log10(k));
}
double hyd_mu(double z,double k){
  return hyd_mu_a(z)
    + (1.0-hyd_mu_a(z)) / (1.0 + exp(hyd_mu_b(z)*log10(k) + hyd_mu_c(z)));
}
double hyd_nu(double z,double k){
  double x = (log10(k)-hyd_nu_b(z))/hyd_nu_c(z), x2=x*x;
  return hyd_nu_a(z) * exp(-0.5*x2);
}

double hyd_log10Mhat(double z,double k){
  return hyd_alpha(z) - (hyd_alpha(z)-hyd_beta(z))*pow(k,hyd_gamma(z));
}

tabulated_function hyd_ftb(AU_FTB_NZ, AU_FTB_NM, AU_FTB_Z,
                           AU_FTB_LOG10MHAT, AU_FTB_F_ARRAY);

double hyd_sup(double z, double k, int hyd_type, double *hyd_param){
  const double hyd_zmax=3, hyd_kmax=12;
  if(z>hyd_zmax || hyd_type==0) return 1;
  if(k>hyd_kmax) return hyd_sup(z,hyd_kmax,hyd_type,hyd_param);
  double lMh=hyd_log10Mhat(z,k), ftb=pow(hyd_ftb(z,lMh),hyd_param[0]);
  if(hyd_type == 2)
    ftb = 0.01*exp(hyd_param[0]) * pow(10.0,(lMh-14.0)*(hyd_param[1]-1))
          * pow(hyd_param[3],hyd_param[2]);
  double lam_h = hyd_lambda(z,k), mu_h = hyd_mu(z,k), nu_h = hyd_nu(z,k);
  return lam_h - (lam_h-mu_h)*exp(-nu_h*ftb);
}

